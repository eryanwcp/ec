var ctx=ctx;var ctxAdmin=ctxAdmin;var ctxStatic=ctxStatic;var sysInitTime=sysInitTime;var isValidateCodeLogin=isValidateCodeLogin;var rememberMeCookieValue=rememberMeCookieValue;var needEncrypt=needEncrypt;var publicKey=publicKey;var SALT=SALT;var securityToken=securityToken;var homePage=homePage;var $loginForm;var $password,$rememberMe;$(function(){$.backstretch([ctxStatic+"/js/images/bg1.jpg?_="+sysInitTime,ctxStatic+"/js/images/bg2.jpg?_="+sysInitTime,ctxStatic+"/js/images/bg3.jpg?_="+sysInitTime],{duration:5000,fade:2000});$("#qr").qrcode({render:"div",size:80,color:"#3a3",text:window.location.href});if(isValidateCodeLogin!=""&&isValidateCodeLogin=="true"){$(".validateCode").show()}$loginForm=$("#loginForm").validate({rules:{validateCode:{remote:ctx+"/servlet/ValidateCodeServlet"}},messages:{loginName:{required:"请填写用户名."},password:{required:"请填写密码."},validateCode:{remote:"验证码不正确.",required:"请填写验证码."}},errorLabelContainer:"#messageBox",errorPlacement:function(a,b){a.appendTo($("#loginError").parent())},submitHandler:function(a){login()}});$password=$("#password");$rememberMe=$("#rememberMe");$rememberMe.prop("checked",rememberMeCookieValue==""?false:true);$password.change(function(){needEncrypt=true});$rememberMe.click(function(){var b=$(this).prop("checked");var a=$password.val();if(needEncrypt){var c=new JSEncrypt();c.setPublicKey(publicKey);a=c.encrypt(a)}if(b){$.cookie("_password",a,{expires:7});$.cookie("rememberMe",b,{expires:7})}else{$.cookie("_password","",{expires:7});$.cookie("rememberMe","",{expires:7})}})});function login(){$("#messageBox2").addClass("hide");$.cookie("loginName",$("#loginName").val(),{expires:7});var a=$password.val();if(needEncrypt){var b=new JSEncrypt();b.setPublicKey(publicKey);a=b.encrypt(a)}if($rememberMe.prop("checked")){$.cookie("_password",a,{expires:7})}$.ajax({url:ctxAdmin+"/login/login",type:"post",data:{theme:"",encrypt:"RSA",loginName:$("#loginName").val(),password:a,validateCode:$("#validateCode").val()},traditional:true,async:false,dataType:"json",success:function(c){if(c.code==1){window.location=c.obj.homeUrl}else{if(c.code==6){$("#loginError2").html(c.msg);$("#messageBox2").removeClass("hide");setTimeout(function(){window.location.href=$.unEscape(c.obj["url"])},3*1000)}else{$("#validateCode").val("");refreshCheckCode();$("#loginError2").html(c.msg);$("#messageBox2").removeClass("hide");if(c.obj!=undefined&&c.obj==true){$(".validateCode").show()}}}}})}function refreshCheckCode(){var a=ctx+"/servlet/ValidateCodeServlet?"+new Date().getTime();$("#validateCodeImage").attr("src",a)};