var $log_datagrid;var $log_search_form;$(function(){$log_search_form=$("#log_search_form").form();$log_datagrid=$("#log_datagrid").datagrid({url:ctxAdmin+"/sys/log",fit:true,pagination:true,rownumbers:true,fitColumns:false,striped:true,pageSize:20,pageList:[10,20,50,100,1000,99999],singleSelect:false,checkbox:true,nowrap:true,border:false,remoteSort:true,idField:"id",frozenColumns:[[{field:"ck",checkbox:true,width:60},{field:"typeView",title:"日志类型",width:80},{field:"userId",title:"用户标识",width:260},{field:"userName",title:"用户名称",width:100}]],columns:[[{field:"id",title:"主键",width:260,sortable:true,hidden:true},{field:"userLoginName",title:"账号",width:120,hidden:true},{field:"userMobile",title:"手机号",width:120,hidden:true},{field:"title",title:"标题",width:200,hidden:false,formatter:function(b,a,c){return"<a target='_blank' href='"+ctxAdmin+"/sys/log/detail?id="+a.id+"'>"+a.title+"</a>"}},{field:"module",title:"模块",width:300},{field:"deviceType",title:"设备类型",width:100},{field:"browserType",title:"浏览器",width:100},{field:"userAgent",title:"客户端",width:300,hidden:true},{field:"ip",title:"IP地址",width:100},{field:"action",title:"操作",width:80},{field:"longitude",title:"经度",width:100,hidden:true},{field:"latitude",title:"纬度",width:100,hidden:true},{field:"remark",title:"备注",width:260,hidden:true},{field:"requestHeaders",title:"请求头",width:260,hidden:true,formatter:function(b,a,c){return typeof a.extendAttr["requestHeaders"]==="string"?a.extendAttr["requestHeaders"]:JSON.stringify(a.extendAttr["requestHeaders"])}},{field:"requestData",title:"请求数据",width:260,hidden:true,formatter:function(b,a,c){return typeof a.extendAttr["requestData"]==="string"?a.extendAttr["requestData"]:JSON.stringify(a.extendAttr["requestData"])}},{field:"extendAttr",title:"自定义参数",width:200,hidden:true,formatter:function(b,a,c){delete b.requestData;delete b.requestHeaders;return JSON.stringify(b)}},{field:"actionTime",title:"操作耗时(ms)",width:100,align:"right"},{field:"operTime",title:"操作时间",width:136,sortable:true}]],toolbar:[{text:"导出",iconCls:"eu-icon-disk_download",handler:function(){exportQuery()}}],onBeforeLoad:function(a){a=$.serializeObject($log_search_form);return true}}).datagrid("showTooltip");$("#_type").combobox({url:ctxAdmin+"/sys/log/logTypeCombobox?selectType=all",editable:false,height:28,width:120})});function exportQuery(){$("#annexFrame").attr("src",ctxAdmin+"/sys/log?export=true&"+$.param($.serializeObject($("#log_search_form"))))}function del(){var a=$log_datagrid.datagrid("getSelections");if(a.length>0){$.messager.confirm("确认提示！","您确定要删除当前选中的所有行？",function(c){if(c){var b=[];$.each(a,function(d,e){b[d]=e.id});$.ajax({url:ctxAdmin+"/sys/log/remove",type:"post",data:{ids:b},traditional:true,dataType:"json",success:function(d){if(d.code===1){$log_datagrid.datagrid("clearSelections");$log_datagrid.datagrid("load");eu.showMsg(d.msg)}else{eu.showAlertMsg(d.msg,"error")}}})}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function delAll(){$.messager.confirm("确认提示！","您确认要清空所有数据？",function(a){if(a){$.post(ctxAdmin+"/sys/log/removeAll",function(b){if(b.code===1){$log_datagrid.datagrid("clearSelections");$log_datagrid.datagrid("load");eu.showMsg(b.msg)}else{eu.showAlertMsg(b.msg,"error")}},"json")}})}function search(){$log_datagrid.datagrid("load",$.serializeObject($log_search_form))};